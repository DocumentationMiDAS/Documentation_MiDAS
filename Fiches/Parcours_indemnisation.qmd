---
title: "Le parcours de l'indemnisation"
---

# Inscription et indemnisation

Cette fiche pr√©sente les principaux concepts de l'indemnisation, la mani√®re dont ils apparaissent dans les donn√©es de l'indemnisation de MiDAS : le Fichier National des Allocataires (FNA) transmis par France Travail, et la m√©thodologie pour reproduire les indicateurs statistiques usuels associ√©s.

::: callout-note
## Programmation

Les programmes fournis sont des programmes R r√©dig√©s en syntaxe `tidyverse`. Les packages du `tidyverse` sont donc n√©cessaires, en particulier le package `dplyr` pour assurer le fonctionnement des programmes. üîß

N√©anmoins, cette condition n'est pas suffisante. Les donn√©es MiDAS exhaustives sont volumineuses et peuvent n√©cessiter des ressources informatiques importantes pour effectuer le calcul des indicateurs √©voqu√©s ici. üíª
:::

**Le parcours de l'indemnisation**

![](/images/parcours_indemnisation_schema.png)

Trois d√©nominations sont utilis√©es au cours de cet article :

-   un **demandeur d'emploi** est une personne inscrite √† France Travail, d√©clarant √™tre en recherche d'un emploi ;

-   un **allocataire de l'Assurance-ch√¥mage**, ou personne prise en charge par l'Assurance-ch√¥mage, ou demandeur d'emploi indemnisable est un demandeur d'emploi qui a une demande d'allocation accept√©e par France Travail ;

-   un **allocataire indemnis√©** est un allocataire qui per√ßoit une allocation.

# D√©p√¥t d'une demande d'allocation

Suite √† la perte involontaire d'un contrat de travail, l'inscription √† France Travail donne lieu √† un accompagnement au retour √† l'emploi. Une fois inscrit, le demandeur d'emploi peut d√©poser une demande d'allocation.

L'ensemble des demandes d'allocation sont renseign√©es dans le segment **DAL** du Fichier National des Allocataires (FNA) de MiDAS. La d√©cision de France Travail √† une demande d'allocation peut √™tre :

-   positive avec **ouverture d'un nouveau droit** : si le demandeur d'emploi remplit la condition d'ouverture de droit, le motif de d√©cision li√© √† la DAL est alors ouverture de droit (`KCNDDA = 1`)

-   positive avec **reprise d'un droit d√©j√† ouvert pr√©c√©demment** : un droit reste valable pendant toute la dur√©e du d√©lai de d√©ch√©ance (voir section d√©di√©e dans cet article)

-   positive avec **rechargement des droit** (voir section d√©di√©e dans cet article)

-   **n√©gative** ou sans objet

Si la d√©cision li√©e √† la demande d'allocation est positive, le demandeur d'emploi **entre √† l'Assurance ch√¥mage** et devient allocataire de l'Assurance-ch√¥mage, ou encore indemnisable √† l'Assurance ch√¥mage. Cette entr√©e √† l'Assurance-ch√¥mage est appel√©e ouverture de droit ou reprise de droit pour les allocataires qui avaient d√©j√† ouvert un droit qui n'a pas d√©pass√© le d√©lai de d√©ch√©ance.

Tout allocataire de l'Assurance-ch√¥mage est donc **n√©cessairement inscrit √† France Travail.**

::: callout-caution
## Indemnisables non inscrits

Les donn√©es administratives peuvent pr√©senter quelques erreurs. Une partie relativement n√©gligeable des allocataires de l'Assurance-ch√¥mage n'ont pas d'inscription en cours dans les donn√©es de l'inscription (Fichier Historique Statistique, FHS). Ces donn√©es sont dites aberrantes car aucun allocataire ne peut percevoir d'allocation ch√¥mage sans avoir une inscription en cours √† France Travail, un d√©faut d'actualisation entra√Ænant directement l'arr√™t du versement.
:::

Une d√©sinscription de France Travail entra√Æne donc une sortie de l'Assurance-ch√¥mage.

# Ouverture de droit üü¢

Un droit √† l'Assurance-ch√¥mage est identifi√© dans le FNA par le couple `id_midas`, `KROD3` (PJC) ou `KROD1` (ODD, DAL).

La table ODD du FNA ne contient pas les dates d'ouverture de droit.

Elle contient la **date du premier versement d'allocation sur le droit** (`KDPOD`) qui ne correspond pas √† la date d'ouverture de droit (ou entr√©e √† l'Assurance-ch√¥mage). Les allocataires commencent presque syst√©matiquement par une p√©riode indemnisable (couverte par l'Assurance-ch√¥mage) non indemnis√©e : la p√©riode de diff√©r√© d'indemnisation (voir la fiche d√©di√©e - √† venir). Certains allocataires peuvent retrouver un emploi et se d√©sinscrire pendant cette p√©riode de diff√©r√© d'indemnisation et ne jamais √™tre indemnis√© sur leur droit. Dans ce cas, la date de premier jour indemnis√© n'est pas renseign√©e.

La **date d'ouverture de droit doit √™tre recalcul√©e √† partir de la table PJC du FNA**. La premiere PJC sur le droit (couple `id_midas`, `KROD3`), celle dont la date de d√©but `KDDPJ` est minimale pour ce couple identifiant, correspond √† l'ouverture de droit. Cette premi√®re PJC est la grande majorit√© du temps non pay√©e, non consomm√©e (`KCPJC = 3`), avec une allocation journali√®re `KQBPJP` nulle car elle correspond √† une p√©riode indemnisable non indemnis√©e de **diff√©r√© d'indemnisation.**

Pour calculer la date d'ouverture de droit et comptabiliser l'ensemble des ouvertures de droit un mois donn√© :

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")

ouvertures_droit_mois <- PJC %>%
  select(id_midas, KROD3, KDDPJ) %>%
  mutate(KDDPJ = as.Date(KDDPJ)) %>%
  group_by(id_midas, KROD3) %>%
  summarise(date_ouv_droit = min(KDDPJ)) %>%
  ungroup() %>%
  filter(date_ouv_droit >= mois_debut & date_ouv_droit <= mois_fin) 
  
```

# Fait g√©n√©rateur

Le fait g√©n√©rateur de l'ouverture de droit est la fin du contrat donnant droit √† une prise en charge par l'Assurance-ch√¥mage. Ce contrat ouvrant le droit est disponible dans la table **CDT du FNA**.

![](/images/schema_FNA.PNG)

Le **fait g√©n√©rateur** est un concept crucial car c'est cette date qui d√©termine g√©n√©ralement l**a r√©glementation dont l'allocataire d√©pend :** lorsqu'une r√©forme de l'indemnisation est mise en place, un droit est concern√© si le fait g√©n√©rateur, c'est-√†-dire la date de fin du contrat ouvrant le droit, a lieu apr√®s la date indiqu√©e pour l'entr√©e en vigueur de la nouvelle r√®gle.

Pour associer une ouverture de droit √† son fait g√©n√©rateur, il existe deux m√©thodes possibles :

-   appariement direct entre la table ODD et la table CDT en utilisant le couple clef d'appariement `id_midas`, `KCCT` (CDT) et son √©quivalent `KCCT1` (ODD)

-   **appariement en deux temps par la table DAL :**

    -   associer un droit d'ODD avec la demande d'allocation de DAL correspondante via le couple clef d'appariement `id_midas`, `KROD1` en conservant uniquement les demandes d'allocation donnant lieu √† une ouverture de droit (`KCNDDA = 1`) ou √† une reprise de droit (`KCNDDA = 3`)

    -   associer une demande d'allocation accept√©e au fait g√©n√©rateur √† l'aide du couple `id_midas`, `KCDA` (DAL) et son homologue `KCDA1` (CDT).

La m√©thode recommand√©e est **l'appariement en deux temps par la table DAL**, pour les raisons suivantes **:**

-   une partie des contrats de travail faits g√©n√©rateurs est manquante dans les donn√©es adminsitratives

-   quelques faits g√©n√©rateurs suppl√©mentaires ne peuvent pas √™tre associ√©s √† un droit par la m√©thode d'appariement direct entre ODD et CDT : pour certains droits, la variable n√©cessaire √† l'appariement `KCCT1` est non renseign√©e dans la table ODD

-   la m√©thode d'appariement via DAL est la m√©thode qui permet de r√©cup√©rer le maximum de faits g√©n√©rateurs.

::: callout-warning
## Entr√©e dans le FNA par PJC ou ODD üí°

Il est conseill√© **de partir des tables PJC ou ODD** pour rep√©rer des allocataires indemnisables ou indemnis√©s d'un champ, plut√¥t que de commencer le rep√©rage par la table CDT du fait g√©n√©rateur.

Partir de la table CDT peut para√Ætre naturel puisque la date de fin de contrat fait g√©n√©rateur conditionne la soumisison √† une r√©glementation d'Assurance-ch√¥mage, mais le fait que certains faits g√©n√©rateurs soit manquants peut conduire √† sous estimer le nombre de personnes du champ vis√©.

Un **proxi de la date du fait g√©n√©rateur peut √™tre la date d'ouverture de droit**. Ce proxi n'est pas parfait : le demandeur d'emploi dispose d'un an pour s'inscrire √† France Travail √† l'issue de sa fin de contrat. En r√©alit√©, l'inscription a souvent lieu peu apr√®s la fin de contrat, et la demande d'allocation est d√©pos√©e tr√®s rapidement √©galement.
:::

```{r}
#| eval: false
#| echo: true

droits_faits_generateurs <- ODD %>%
  distinct(id_midas, KROD1) %>%
  left_join(DAL, by = c("id_midas", "KROD1")) %>%
  filter(KNCDDA == 1 | KCNDDA == 3) %>%
  distinct(id_midas, KROD1, KCDA) %>%
  rename(KCDA1 = KCDA) %>%
  left_join(CDT, by = c("id_midas", "KCDA1")) %>%
  distinct(id_midas, KROD1, KDFPE)
```

# Dur√©e potentielle d'indemnisation üü¢

Un droit se caract√©rise par une dur√©e potentielle d'indemnisation. La dur√©e potentielle d'indemnisation d√©pend de la r√©glementation dont d√©pend le droit.

La variable `KPJDXP`de la table **ODD** renseigne la dur√©e potentielle d'indemnisation, mais elle pr√©sente des **valeurs aberrantes**. Elle doit √™tre redress√©e avant d'√™tre utilis√©e.

La dur√©e potentielle d'indemnisation d√©pend de l'√¢ge de l'allocataire au moment de la fin de contrat fait g√©n√©rateur de l'ouverture de droit. La dur√©e potentielle d'indemnisation donn√©e par `KPJDXP` d√©passe parfois la borne maximale l√©gale pour la classe d'√¢ge de l'allocataire. Il faut donc borner cette dur√©e maximale par la dur√©e l√©gale connue.

L'√¢ge √† la fin du contrat de travail peut √™tre calcul√© √† l'aide de la date de naissance disponible dans la table DE du FHS. Pour les faits g√©n√©rateurs manquants, il est possible de lui substituer l'√¢ge √† l'ouverture de droit.

Par exemple, en distinguant les droits ouverts avant le 1er f√©vrier 2023 (date d'entr√©e en vigueur de la contracyclicit√©) et les droits ouverts ensuite :

```{r}
#| eval: false
#| echo: true

droit_datnais <- DE %>%
  distinct(id_midas, datnais) %>%
  right_join(ODD, by = c("id_midas")) %>%
  distinct(id_midas, KROD1, datnais)

date_ouvertures_droit <- PJC %>%
  select(id_midas, KROD3, KDDPJ) %>%
  mutate(KDDPJ = as.Date(KDDPJ)) %>%
  group_by(id_midas, KROD3) %>%
  summarise(date_ouv_droit = min(KDDPJ)) %>%
  ungroup() %>%
  rename(KROD1 = KROD3) %>%
  right_join(droit_datnais, by = c("id_midas", "KROD1"))

fait_generateur <- DAL %>%
  right_join(date_ouvertures_droit, by = c("id_midas", "KROD1")) %>%
  filter(KNCDDA == 1 | KCNDDA == 3) %>%
  distinct(id_midas, KROD1, KCDA, datnais) %>%
  rename(KCDA1 = KCDA) %>%
  left_join(CDT, by = c("id_midas", "KCDA1")) %>%
  distinct(id_midas, KROD1, KDFPE, datnais) %>%
  mutate(KDFPE = as.Date(KDFPE),
         datnais = as.Date(datnais),
         age_fin_ctt = case_when(!(is.na(KDFPE)) ~ KDFPE - datnais,
                                 (is.na(KDFPE)) ~ date_ouv_droit - datnais))


duree_max_redressee <- ODD %>%
  right_join(fait_generateur, by = c("id_midas", "KROD1")) %>%
  mutate(duree_max = case_when(age_fin_ctt < 53 & (KDFPE < as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit < as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 730, 730, KPJDXP),
                               age_fin_ctt >= 53 & age_fin_ctt < 55 & (KDFPE < as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit < as.Date("2023-02-01")))~ ifelse(KPJDXP > 913, 913, KPJDXP),
                               age_fin_ctt >= 55 & (KDFPE < as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit < as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 1095, 1095, KPJDXP),
                               age_fin_ctt < 53 & (KDFPE >= as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit >= as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 548, 548, KPJDXP),
                               age_fin_ctt >= 53 & age_fin_ctt < 55 & (KDFPE >= as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit >= as.Date("2023-02-01")))~ ifelse(KPJDXP > 685, 685, KPJDXP),
                               age_fin_ctt >= 55 & (KDFPE <= as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit <= as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 822, 822, KPJDXP)))


```

# Ensemble des indemnisables üîµ

Une personne indemnisable dispose d'une PJC en cours dans la table **PJC** du FNA, qu'elle soit pay√©e et consomm√©e (`KCPJC = 1`), non pay√©e et consomm√©e (`KCPJC = 2`), ou non pay√©e et non consomm√©e (`KCPJC = 3`).

## En fin de mois üîµ

```{r}
#| eval: false
#| echo: true

mois_fin <- as.Date("2021-01-31")

indemnisable_fm <- PJC %>%
  select(id_midas, KCPJC, KDDPJ, KDFPJ) %>%
  filter(KDDPJ <= mois_fin & KDFPJ >= mois_fin) %>%
  distinct(id_midas)

```

## Tout le mois

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")
mois_duree  = mois_fin - mois_debut + 1

indemnisable_tm <- PJC %>%
  select(id_midas, KCPJC, KDDPJ, KDFPJ) %>%
  mutate(KDDPJ_trunc = if_else(KDDPJ < mois_debut, mois_debut, KDDPJ),
         KDFPJ_truc = if_else(KDFPJ > mois_fin, mois_fin, KDFPJ)) %>%
  filter(KDDPJ <= mois_fin & KDFPJ >= mois_debut) %>%
  mutate(duree_PJC_trunc = KDFPJ_trunc - KDDPJ_trunc) %>%
  group_by(id_midas) %>%
  summarise(duree_indemnisable = sum(duree_PJC_trunc)) %>%
  ungroup() %>%
  filter(duree_indemnisable == mois_duree) %>%
  distinct(id_midas)

```

## Au cours du mois

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")

indemnisable_cm <- PJC %>%
  select(id_midas, KCPJC, KDDPJ, KDFPJ) %>%
  filter(KDDPJ <= mois_fin & KDFPJ >= mois_debut) %>%
  distinct(id_midas)
```

## Cas de l'activit√© r√©duite

Un allocataire peut cumuler une partie de ses allocations avec le revenu d'une activit√© r√©duite, dans la limite de son SJR mensualis√©. Ainsi, une partie seulement de son allocation mensuelle lui est vers√©e, et la partie non vers√©e et non consomm√©e du fait de l'activit√© r√©duite est report√©e.

Dans les donn√©es de l'indemnisation (PJC du FNA), cette r√©glementation est renseign√©e de la fa√ßon suivante :

-   le montant d'allocation vers√© est reseign√© sous forme de jours consomm√©s et pay√©s d'allocation. L'indemnisation est fond√©e sur le concept d'un montant journalier d'allocation vers√© pendant un nombre de jours d'au maximum la dur√©e potentielle d'indemnisation. Lorsqu'une partie seulement de l'allocation est vers√©e sur le mois, ce montant mensuel est traduit en nombre de jours indemnis√©s au montant d'allocation journali√®re sur le mois. Ces jours pay√©s consomm√©s forment une PJC unique pay√©e consomm√©e (`KCPJC = 1`) en d√©but de mois.

-   le montant non vers√© du fait de l'activit√© r√©duite correspond au nombre de jours non indemnis√©s au montant d'allocation journali√®re du reste du mois. Pour ces jours restants sur le mois, une unique PJC non pay√©e non consomm√©e (`KCPJC = 3`) sur la deuxi√®me partie du mois, qui commence le jour suivant la fin de la PJC pay√©e consomm√©e. L'allocataire est alors dit indemnisable.

::: callout-note
## Exemple

Un allocataire dispose d'un SJR de 70‚Ç¨. Son allocation journali√®re correspond √† 57% de son SJR, soit 39,9‚Ç¨. Il d√©bute une activit√© au d√©but du mois m avec un salaire de 230‚Ç¨. Pour un euro d'activit√© r√©duite gagn√©, il perd uniquement 70 centimes d'allocation. Son allocation mensuelle de 1197‚Ç¨ diminue donc de 161‚Ç¨ (0,7 x 230‚Ç¨). Ces 161‚Ç¨ repr√©sentent 4 jours indemnis√©s au montant d'allocation journali√®re de 39,9‚Ç¨. Dans les donn√©es, au mois m, cet allocataire aura :

-   une PJC pay√©e, consomm√©e du 1er au 26√®me jour du mois m ;

-   une PJC non pay√©e non consomm√©e du 27√®me jour au 30√®me jour du mois m.

Ces 4 jours non pay√©s non consomm√©s sont report√©s et pourront √™tre consomm√©s plus tard.

Son revenu total augmente donc au mois m : 1266‚Ç¨ au lieu de 1197‚Ç¨.
:::

Ces allocataires comptent parmi les indemnisables en fin de mois, mais parmi les indemnis√©s au cours du mois.

# Ensemble des indemnis√©s üîµ

## En fin de mois üîµ

```{r}
#| eval: false
#| echo: true

mois_fin <- as.Date("2021-01-31")

indemnisable_fm <- PJC %>%
  select(id_midas, KCPJC, KDDPJ, KDFPJ) %>%
  filter(KDDPJ <= mois_fin & KDFPJ >= mois_fin & KCPJC == 1) %>%
  distinct(id_midas)
```

## Tout le mois

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")

indemnisable_tm <- PJC %>%
  select(id_midas, KCPJC, KDDPJ, KDFPJ) %>%
  filter(KDDPJ <= mois_fin & KDFPJ >= mois_debut) %>%
  mutate(PJC_payee = if_else(KCPJC == 1, 1, 0)) %>%
  group_by(id_midas) %>%
  summarise(nb_PJC = n(),
            nb_PJC_payee = sum(PJC_payee)) %>%
  ungroup() %>%
  filter(nb_PJC == nb_PJC_payee) %>%
  distinct(id_midas)

```

## Au cours du mois

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")

indemnisable_cm <- PJC %>%
  select(id_midas, KCPJC, KDDPJ, KDFPJ) %>%
  filter(KDDPJ <= mois_fin & KDFPJ >= mois_debut & KCPJC == 1) %>%
  distinct(id_midas)
```

# Distinction par r√©gime üîµ

[La fiche d√©di√©e sur les allocations et r√©gimes d'indemnisation](../Fiches/Allocations_regimes.qmd) associe chaque code allocation d√©taill√© des variables `KCAAJ` de la table ODD et `KCALF`de la table PJC √† l'allocaiton agr√©g√©e et au r√©gime d'indemnisation correspondant. Un exemple de programme R correspondant est disponible ci-dessous.

SUITE A VENIR

```{r}
#| eval: false
#| echo: true

```

## R√©gimes particuliers

Les r√©gimes particuliers d√©pendant d'annexes √† la convention d'Assurance-ch√¥mage sont donn√©s par la variable `KCRD` de la table ODD. Les exclusions de champ classiques concernent souvent le r√©gime des intermittents du spectacle, qui correspondent aux annexes VII et X (`KCRD = 28` et `KCRD = 29`).

# Consommation de droit üü¢

Pour calculer le nombre de jours consomm√©s dans le droit, il faut sommer les **p√©riodes consomm√©es de ce droit dans la table PJC.**

Les p√©riodes consomm√©es sont :

-   les p√©riodes "consomm√©es et pay√©es" (`KCPJC = 1`)

-   les p√©riodes consomm√©es non pay√©es (`KCPJC = 2`)

-   les p√©riodes consomm√©es et pay√©es au titre des aides (`KCPJC = 4`) : elles sont inexistantes sur p√©riode r√©cente.

Par exemple, voici le programme pour calculer la consommation de droit d'un ensemble d'allocataires ouvrant un droit au cours de ce mois.

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")

ouvertures_droit_mois <- PJC %>%
  select(id_midas, KROD3, KDDPJ) %>%
  mutate(KDDPJ = as.Date(KDDPJ)) %>%
  group_by(id_midas, KROD3) %>%
  summarise(date_ouv_droit = min(KDDPJ)) %>%
  ungroup() %>%
  filter(date_ouv_droit >= mois_debut & date_ouv_droit <= mois_fin) 

conso_droit <- PJC %>%
  filter(KCPJC == 1 | KCPJC == 2 | KCPJC == 4) %>%
  mutate(KDDPJ = as.Date(KDDPJ),
         KDFPJ = as.Date(KDFPJ),
         duree_PJC = KDFPJ - KDDPJ + 1)
  right_join(ouvertures_droit_mois, by = c("id_midas", "KROD3")) %>%
  group_by(id_midas, KROD3) %>%
  summarise(conso_droit_obs = sum(duree_PJC, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(conso_droit = ifelse(is.na(conso_droit_obs, 0, conso_droit_obs)))
  

```

::: callout-caution
## Droit ouvert non consomm√©

Un droit peut avoir √©t√© ouvert sans qu'aucun jour n'ait jamais √©t√© consomm√©. C'est le cas des allocataires qui se d√©sinscrivent pendant leur p√©riode de diff√©r√© d'indemnisation.
:::

# Reprises de droit üü¢

Un droit ouvert √† l'Assurance-ch√¥mage peut √™tre **repris suite √† une d√©sinscription.**

Comme repr√©sent√© sur le sch√©ma ci-dessous, un allocataire peut retrouver un contrat et se d√©sinscrire de France Travail, ce qui met fin √† son indemnisation automatiquement. Cet allocataire peut par exemple parvenir √† la fin d'un CDD de 2 mois et s'inscrire √† nouveau √† France Travail pour la perte involontaire de ce contrat de travail. Une nouvelle demande d'allocation est d√©pos√©e et peut donner lieu √† la reprise du droit pr√©c√©demment ouvert √† la suite de la perte du premier contrat, un CDI de 2 ans.

Cette reprise est possible √† deux conditions :

-   si le droit pr√©c√©demment ouvert n'a **pas encore √©t√© enti√®rement consomm√©**

-   si le droit n'a **pas atteint son d√©lai de d√©ch√©ance** : trois ans allong√© de la dur√©e potentielle d'indemnisation initiale. Il existe des cas particuliers permettant d'allonger ce d√©lai.

**Illustration d'un cas-type de reprise de droit**

![](/images/reprise_droit.png)

Dans les donn√©es, le rep√©rage des reprises de droit se fait comme suit : lorsque deux PJC sur le m√™me droit (m√™me couple identifiant `id_midas`, `KROD3`) sont espac√©es d'au moins un jour, la nouvelle PJC correspond √† une reprise de droit.

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")

reprise_droit <- PJC %>%
  group_by(id_midas, KROD3) %>%
  arrange(id_midas, KROD3, KDDPJ) %>%
  mutate(ecart = KDDPJ - lag(KDFPJ)) %>%
  ungroup() %>%
  filter(ecart > 0 & KDDPJ >= mois_debut & KDDPJ <= mois_fin) 
```

## Droit d'option

Dans le cas o√π une personne aurait assez travaill√© suite √† sa d√©sincription pour ouvrir un nouveau droit, tandis que son ancien droit n'est pas d√©chu, par exemple dans la situation repr√©sent√©e ci-dessous :

**Illustration d'un cas-typ de droit d'option**

![](/images/droit_option.png)

Il existe une possibilit√© **d'opter sous conditions pour le droit nouvellement ouvert du fait de cette nouvelle p√©riode travaill√©e**. Les conditions sont d√©taill√©es [dans cet article de l'UNEDIC.](https://www.unedic.org/la-reglementation/fiches-thematiques/droit-doption)

Le nouveau droit ouvert avec droit d'option corrrespond alors √† un nouveau couple identifiant `id_midas`, `KROD3` . L'ouverture d'un nouveau droit li√© √† un droit d'option correspond √† une demande d'allocation dans DAL dont le motif de d√©cision est Ouverture de droit suite √† "Exercice du Droit d'Option" (AC 2014) (`KCNDDA = 12` ) ou Ouverture de droit suite √† "Exercice du Droit d'Option" autre qu'apprentis (Avenants AC 2014) (`KCNDDA = 13` ).

# Fins de droit üü¢

Une fin de droit a lieu lorsque l'allocataire consomme une dur√©e √©gale √† la dur√©e potentielle d'indemnisation de son droit.

Pour rep√©rer une fin de droit, il suffit de v√©rifier que la dur√©e consomm√© du droit √† la date de fin de PJC est √©gale √† la dur√©e potentielle d'indemnisation redress√©e.

```{r}
#| eval: false
#| echo: true

mois_debut <- as.Date("2021-01-01")
mois_fin <- as.Date("2021-01-31")

# Calcul de la duree maximale redressee

droit_datnais <- DE %>%
  distinct(id_midas, datnais) %>%
  right_join(ODD, by = c("id_midas")) %>%
  distinct(id_midas, KROD1, datnais)

date_ouvertures_droit <- PJC %>%
  select(id_midas, KROD3, KDDPJ) %>%
  mutate(KDDPJ = as.Date(KDDPJ)) %>%
  group_by(id_midas, KROD3) %>%
  summarise(date_ouv_droit = min(KDDPJ)) %>%
  ungroup() %>%
  rename(KROD1 = KROD3) %>%
  right_join(droit_datnais, by = c("id_midas", "KROD1"))

fait_generateur <- DAL %>%
  right_join(date_ouvertures_droit, by = c("id_midas", "KROD1")) %>%
  filter(KNCDDA == 1 | KCNDDA == 3) %>%
  distinct(id_midas, KROD1, KCDA, datnais) %>%
  rename(KCDA1 = KCDA) %>%
  left_join(CDT, by = c("id_midas", "KCDA1")) %>%
  distinct(id_midas, KROD1, KDFPE, datnais) %>%
  mutate(KDFPE = as.Date(KDFPE),
         datnais = as.Date(datnais),
         age_fin_ctt = case_when(!(is.na(KDFPE)) ~ KDFPE - datnais,
                                 (is.na(KDFPE)) ~ date_ouv_droit - datnais))


duree_max_redressee <- ODD %>%
  right_join(fait_generateur, by = c("id_midas", "KROD1")) %>%
  mutate(duree_max = case_when(age_fin_ctt < 53 & (KDFPE < as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit < as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 730, 730, KPJDXP),
                               age_fin_ctt >= 53 & age_fin_ctt < 55 & (KDFPE < as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit < as.Date("2023-02-01")))~ ifelse(KPJDXP > 913, 913, KPJDXP),
                               age_fin_ctt >= 55 & (KDFPE < as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit < as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 1095, 1095, KPJDXP),
                               age_fin_ctt < 53 & (KDFPE >= as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit >= as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 548, 548, KPJDXP),
                               age_fin_ctt >= 53 & age_fin_ctt < 55 & (KDFPE >= as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit >= as.Date("2023-02-01")))~ ifelse(KPJDXP > 685, 685, KPJDXP),
                               age_fin_ctt >= 55 & (KDFPE <= as.Date("2023-02-01") | (is.na(KDFPE) & date_ouv_droit <= as.Date("2023-02-01"))) ~ ifelse(KPJDXP > 822, 822, KPJDXP)))

# Rep√©rage des fins de PJC un mois donn√©

fin_pjc <- PJC %>%
  mutate(KDFPJ = as.Date(KDFPJ)) %>%
  filter(KDFPJ <= mois_fin & KDFPJ >= mois_deb) %>%
  group_by(id_midas, KROD3) %>%
  filter(KDFPJ_borne == max(KDFPJ)) %>%
  ungroup() 

# Calcul des consommations de droit √†  la fin de PJC rep√©rer

conso_droit <- PJC %>%
  filter(KCPJC == 1 | KCPJC == 2 | KCPJC == 4) %>%
  mutate(KDDPJ = as.Date(KDDPJ),
         KDFPJ = as.Date(KDFPJ),
         duree_PJC = KDFPJ - KDDPJ + 1)
  right_join(fin_pjc, by = c("id_midas", "KROD3")) %>%
  filter(KDFPJ <= KDFPJ_borne)
  group_by(id_midas, KROD3) %>%
  summarise(conso_droit_obs = sum(duree_PJC, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(conso_droit = ifelse(is.na(conso_droit_obs, 0, conso_droit_obs))) 
  
# Comparaison √† la dur√©e potentielle d'indemnisation

fin_droit <- conso_droit %>%
  left_join(duree_max_redressee, by = c("id_midas", "KROD3")) %>%
  filter(conso_droit == duree_max) %>%
  distinct(id_midas, KROD3)
```

## Suivies d'un rechargement üü¢

Le rep√©rage des rechargements suite √† une fin de droit est permis par la table DAL. Au sujet des rechargements, voir l'article de l'UNEDIC [√† ce lien](https://www.unedic.org/la-reglementation/fiches-thematiques/droits-rechargeables).

Un rechargement correspond √† un nouveau couple identifiant `id_midas`, `KROD3` . Si la fin de droit est suivie de l'ouverture d'un nouveau droit associ√© √† une demande d'allocation de type rechargement (`KCDAL = 26`) dont la d√©cision est "ouverture de droit suite √† rechargement (AC 2014)" (`KCNDDA = 10`).

```{r}
#| eval: false
#| echo: true

date_fin_droit <- PJC %>%
  select(id_midas, KROD3, KDFPJ) %>%
  mutate(KDDPJ = as.Date(KDDPJ)) %>%
  group_by(id_midas, KROD3) %>%
  filter(KDFPJ == max(KDFPJ)) %>%
  ungroup() %>%
  rename(date_fin_droit = KDFPJ) %>%
  right_join(fin_droit, by = c("id_midas", "KROD3"))

nouveau_droit <- PJC %>%
  select(id_midas, KROD3, KDDPJ) %>%
  mutate(KDDPJ = as.Date(KDDPJ)) %>%
  group_by(id_midas, KROD3) %>%
  summarise(date_ouv_droit = min(KDDPJ)) %>%
  ungroup() %>%
  rename(KROD3_rechargement = KROD3) %>%
  right_join(date_fin_droit, by = c("id_midas")) %>%
  filter(date_ouv_droit >= date_fin_droit) %>%
  mutate(ecart = date_fin_droit - date_ouv_droit) %>%
  filter(ecart <= 30) 

rechargement <- DAL %>%
  select(id_midas, KROD1, KCDAL, KCNDDA) %>%
  rename(KROD3_rechargement = KROD1) %>%
  right_join(nouveau_droit, by = c("id_midas", "KROD3_rechargement")) %>%
  filter(KCDAL == 26 & KCNDDA == 10) %>%
  distinct(id_midas, KROD1)
```

# Glossaire de l'indemnisation

Ce glossaire est tir√© du [bilan indemnisation 2022](https://dares.travail-emploi.gouv.fr/publication/indemnisation-des-demandeurs-demploi-en-2022#:~:text=L'allocation%20journali%C3%A8re%20est%20calcul%C3%A9e,%C3%A0%20partir%20de%20juillet%202022.) publi√© par la Dares.

-   **Entree √† l'Assurance-ch√¥mage :** une entr√©e √† l'Assurance-ch√¥mage a lieu lorsqu'un demandeur d'emploi devient indemnisable, √† la suite d'une perte d'emploi (ouverture de droit), ou d'une interruption (pour maladie par exemple) ou d'une ouverture de nouveaux droits.

-   **Dur√©e maximale d'indemnisation :** la dur√©e maximale d'indemnisation, ou dur√©e du droit, correspond au nombre de jours d'indemnisation auquel donnent droit les p√©riodes d'affiliation qui ont √©t√© liquid√©es.

-   **Indemnisable √† l'Assurance-ch√¥mage :** une personne est dite "indemnisable" ou "couverte par une allocation" ou "a des droits ouverts √† cette allocation", si elle a d√©pos√© une demande d'allocation qui a √©t√© accept√©e.

-   **Indemnisable en fin de mois :** indemnisable le dernier jour de ce mois.

-   **Indemnisabilit√© continue :** une personne est contin√ªment indemnisable un mois donn√© lorsque qu'elle est indemnisable tous les jours de ce mois, m√™me si elle a chang√© d'allocation au cours du mois.

-   **Indemnis√© :** une personne est indemnis√©e par une allocation un mois donn√© si elle per√ßoit effectivement une allocation ce mois-ci. Dans certaines situations (activit√© r√©duite, diff√©r√© ou d√©lai d'attente, sanction), une personne peut √™tre indemnisable un mois donn√© mais non indemnis√©e.

-   **P√©riode √† Justification Constante (PJC) :** c'est une p√©riode pendant laquelle le montant vers√© est constant. Elle est donc d√©finie par une date de d√©but, une date de fin et un montant fixe d'allocation journali√®re vers√©e. Une p√©riode √† justification constante peut correspondre √† un montant d'allocation journali√®re de 0 : l'allocataire est dit indemnisable non indemnis√©. Il est pris en charge par l'Assurance-ch√¥mage mais aucune allocation ne lui est vers√©e pour plusieurs motifs : atteinte du plafond de cumul d'activit√© r√©duite, prise en charge temporaire par la S√©curit√© Sociale, p√©riode de diff√©r√© d'indemnisation...

-   **Dur√©e consomm√©e de droit :** la dur√©e consomm√©e sur le droit est d√©finie comme le cumul des jours d√©j√† indemnis√©s au titre de ce droit √† une date donn√©e. Elle ne peut √™tre sup√©rieure √† la dur√©e maximale d'indemnisation.

-   **Sortie de l'Assurance-ch√¥mage :** une sortie de l'Assurance-ch√¥mage correspond √† une interruption d'un droit d'au moins un jour ou √† une fin de droits. Lorsqu'une personne cesse de percevoir une allocation, mais que le droit reste ouvert (pratique d'une activit√© r√©duite par exemple), elle ne sort pas de l'Assurance-ch√¥mage.

# Cibles

Pour v√©rifier la m√©thodologie utilis√©e en programmation pour reproduire des indicateurs statistiques usuels √† partir des donn√©es de l'indemnisation, il est possible d'utiliser les sources suivantes :

-   le bilan annuel sur l'indemnisation des demandeurs d'emploi publi√© par la Dares : [l'indemnisation des demandeurs d'emploi en 2022](https://dares.travail-emploi.gouv.fr/publication/indemnisation-des-demandeurs-demploi-en-2022#:~:text=L'allocation%20journali%C3%A8re%20est%20calcul%C3%A9e,%C3%A0%20partir%20de%20juillet%202022.). Il contient les indicateurs pr√©sent√©s ici rep√©r√©s par un üîµ

-   le tableau de suivi de l'Assurance ch√¥mage mis √† jour mensuellement par l'UNEDIC : [indicateurs de suivi de l'Assurance-ch√¥mage par d√©partement](https://data.unedic.org/explore/dataset/evolution_indicateurs_cles_ac/table/?disjunctive.region&disjunctive.departement&sort=region). Il contient les indicateurs pr√©sent√©s ici rep√©r√©s par un üü¢
