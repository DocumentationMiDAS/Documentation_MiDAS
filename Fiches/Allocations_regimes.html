<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Allocations agrégées et régimes d’indemnisation – Documentation MiDAS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ee590d1db77319ae38f478d857c8e9b6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Documentation MiDAS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../Presentation/présentation.html"> 
<span class="menu-text">MiDAS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../FHS/FHS_presentation.html"> 
<span class="menu-text">FHS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../FNA/FNA_presentation.html"> 
<span class="menu-text">FNA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Allstat_FR6/Allstat_FR6_presentation.html"> 
<span class="menu-text">Allstat-FR6</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../DSN/DSN_presentation.html"> 
<span class="menu-text">DSN</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../Fiches/Fiches_presentation.html" aria-current="page"> 
<span class="menu-text">Fiches</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Codes/codes_presentation.html"> 
<span class="menu-text">Codes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Fiches/Allocations_regimes.html">Allocations agrégées et régimes d’indemnisation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Fiches_presentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fiches thématiques</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Cluster_spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programmer sur un cluster spark</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Retour_emploi_rsa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mesurer l’emploi salarié</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Maintien_de_droits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maintien de droits</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Allocations_regimes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Allocations agrégées et régimes d’indemnisation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Parcours_indemnisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Le parcours de l’indemnisation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Differe_indemnisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Différé d’indemnisation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Activité réduite.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Activité réduite</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Foyers_BRSA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foyers bénéficiaires du RSA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fiches/Cumul_AC_MS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cumul allocation-chômage et minima sociaux</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#régime-de-lassurance-chômage" id="toc-régime-de-lassurance-chômage" class="nav-link active" data-scroll-target="#régime-de-lassurance-chômage">Régime de l’assurance-chômage</a></li>
  <li><a href="#régime-de-létat" id="toc-régime-de-létat" class="nav-link" data-scroll-target="#régime-de-létat">Régime de l’État</a></li>
  <li><a href="#régime-de-france-travail" id="toc-régime-de-france-travail" class="nav-link" data-scroll-target="#régime-de-france-travail">Régime de France Travail</a></li>
  <li><a href="#reconstituer-les-régimes-dindemnisation" id="toc-reconstituer-les-régimes-dindemnisation" class="nav-link" data-scroll-target="#reconstituer-les-régimes-dindemnisation">Reconstituer les régimes d’indemnisation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Allocations agrégées et régimes d’indemnisation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Date de mise à jour : septembre 2025</p>
<p>Cette fiche regroupe les modalités qui renseignent sur les allocations, aides et primes perçues par les allocataires de l’assurance-chômage. De nouvelles modalités apparaissent avec l’ajout de nouveaux dispositifs d’indemnisation et la modification des conventions d’assurance-chômage. A chaque nouvelle vague de MiDAS, cette fiche sera donc mise à jour dès que possible pour les intégrer.</p>
<p>Les codes allocations, renseignés dans la variable KCALF (segment PJC) et la variable KCAAJ (segment ODD), sont identiques. Les <em>aides</em> et <em>primes</em> sont renseignées dans la variable KCDPR (segment PRM).</p>
<p>Cette fiche regroupe l’ensemble des allocations, aides et primes versées par régimes d’indemnisation puis par groupes d’allocation. Elle fournit également un descriptif des trois régimes d’indemnisation ainsi qu’un script pour les reconstituer.</p>
<section id="régime-de-lassurance-chômage" class="level1">
<h1>Régime de l’assurance-chômage</h1>
<p>L’assurance-chômage garantit une allocation, pendant une durée limitée, aux salariés involontairement privés d’emploi et ayant suffisamment contribué. <strong>L’allocation d’aide au retour à l’emploi</strong> (<a href="https://www.unedic.org/la-reglementation/fiches-thematiques/allocation-d-aide-au-retour-a-l-emploi-are">ARE</a>) est la principale allocation d’assurance-chômage, puisqu’elle représente 90&nbsp;% des dépenses. Elle est versée aux personnes involontairement privées de leur dernier emploi ou qui démissionnent pour des raisons légitimes. En cas de formation, elle est remplacée par <strong>l’ARE-formation</strong> (Aref), de même montant que l’ARE. Le régime de l’assurance-chômage comprend également l’<strong>allocation de sécurisation professionnelle</strong> (<a href="https://www.unedic.org/la-reglementation/fiches-thematiques/allocation-de-securisation-professionnelle-asp">ASP</a>) ou encore l’<strong>aide à la reprise ou à la création d’entreprise</strong> (<a href="https://www.unedic.org/la-reglementation/fiches-thematiques/aide-la-reprise-ou-la-creation-dentreprise-arce">Arce</a>).</p>
</section>
<section id="régime-de-létat" class="level1">
<h1>Régime de l’État</h1>
<p>Le régime de solidarité prend en charge les personnes n’ayant pas ou plus de droit à l’assurance-chômage et pouvant justifier d’une durée d’activité de 5 ans dans les 10 années précédant la fin du contrat de travail. <strong>L’allocation de solidarité spécifique</strong> (<a href="https://drees.solidarites-sante.gouv.fr/sites/default/files/2023-09/MS2023-Fiche%2023%20-%20L%E2%80%99allocation%20de%20solidarit%C3%A9%20sp%C3%A9cifique%20%28ASS%29.pdf">ASS</a>) est la principale allocation d’État. Les autres allocations sont&nbsp;: l’ASS-formation, l’aide aux chômeurs et créateurs d’entreprise (Accre-ASS), l’allocation équivalent retraite (AER),&nbsp;devenue l’allocation transitoire de solidarité (ATS), l’allocation temporaire d’attente (ATA), ainsi que les allocations du Fonds de professionnalisation et de solidarité (AFPS), qui regroupent l’allocation de professionnalisation et de solidarité (APS) et l’allocation de fin de droits (AFD).</p>
</section>
<section id="régime-de-france-travail" class="level1">
<h1>Régime de France Travail</h1>
<p>Le régime de France Travail concerne les personnes prises en charge par l’opérateur au titre d’une convention de gestion (qui permet aux <a href="https://www.francetravail.fr/employeur/vos-declarations-et-cotisations/vous-etes-un-employeur-public/lassurance-chomage-des-employeur.html">employeurs publics</a> de confier la gestion administrative de l’indemnisation à France Travail) ou d’une formation&nbsp;: il peut s’agir d’un projet de formation cofinancé par France Travail, qui donne droit à une <strong>rémunération de formation de France Travail</strong> (<a href="https://www.francetravail.fr/candidat/en-formation/les-dispositifs/la-remuneration-des-formations-d.html">RFFT</a>, anciennement RFPE), ou bien d’une <strong>rémunération de fin de formation</strong> (<a href="https://www.francetravail.fr/candidat/en-formation/les-dispositifs/la-remuneration-de-fin-de-format.html">RFF</a>), si l’allocation de formation perçue par le demandeur d’emploi se termine avant la fin de sa formation.</p>
</section>
<section id="reconstituer-les-régimes-dindemnisation" class="level1">
<h1>Reconstituer les régimes d’indemnisation</h1>
<p>On peut reconstituer les régimes d’indemnisation en appariant les tables PJC, ODD et PRM.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement des tables</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>PJC_s <span class="ot">&lt;-</span> <span class="fu">spark_read_parquet</span>(sc,<span class="at">path =</span> <span class="st">"hdfs:///dataset/MiDAS_v7/FNA/pjc.parquet"</span>,<span class="at">memory=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>PRM_s <span class="ot">&lt;-</span> <span class="fu">spark_read_parquet</span>(sc,<span class="at">path =</span> <span class="st">"hdfs:///dataset/MiDAS_v7/FNA/prm.parquet"</span>,<span class="at">memory=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>ODD_s <span class="ot">&lt;-</span> <span class="fu">spark_read_parquet</span>(sc,<span class="at">path =</span> <span class="st">"hdfs:///dataset/MiDAS_v7/FNA/odd.parquet"</span>,<span class="at">memory=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">#### Période étudiée ####</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>date_fin <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-12-31"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>date_deb <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-12-01"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">##### Allocations agrégées et régimes d'indemnisation #####</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>codes_pjc <span class="ot">&lt;-</span> PJC_s <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code_alloc =</span> <span class="fu">case_when</span>(KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"01"</span>,<span class="st">"21"</span>,<span class="st">"22"</span>,<span class="st">"27"</span>,<span class="st">"40"</span>,<span class="st">"43"</span>,<span class="st">"47"</span>,<span class="st">"54"</span>,<span class="st">"64"</span>,<span class="st">"67"</span>,<span class="st">"82"</span>,<span class="st">"AC"</span>,<span class="st">"BB"</span>,<span class="st">"BK"</span>,<span class="st">"CJ"</span>,<span class="st">"DM"</span>,<span class="st">"EF"</span>,<span class="st">"EW"</span>,<span class="st">"FL"</span>,<span class="st">"GV"</span>,<span class="st">"HF"</span>,<span class="st">"HI"</span>) <span class="sc">~</span> <span class="st">"ARE"</span>, <span class="co"># Allocation d'aide au retour à l'emploi</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"CN"</span> <span class="sc">~</span> <span class="st">"ARE-I"</span>, <span class="co"># ARE intermittent</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BP"</span>,<span class="st">"CQ"</span>,<span class="st">"HU"</span>) <span class="sc">~</span> <span class="st">"ARED"</span>, <span class="co"># ARE différée</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"HF"</span> <span class="sc">~</span> <span class="st">"CFD"</span>, <span class="co"># Allocation de complément de fin de droit</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"33"</span>,<span class="st">"34"</span>,<span class="st">"35"</span>,<span class="st">"48"</span>,<span class="st">"49"</span>,<span class="st">"55"</span>,<span class="st">"65"</span>,<span class="st">"83"</span>,<span class="st">"AD"</span>,<span class="st">"BC"</span>,<span class="st">"BN"</span>,<span class="st">"CK"</span>,<span class="st">"DQ"</span>,<span class="st">"EL"</span>,<span class="st">"EX"</span>,<span class="st">"FO"</span>,<span class="st">"GZ"</span>,<span class="st">"HO"</span>) <span class="sc">~</span> <span class="st">"AREF"</span>, <span class="co"># ARE formation</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"CO"</span> <span class="sc">~</span> <span class="st">"AREF-I"</span>, <span class="co"># AREF intermittent</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BQ"</span>,<span class="st">"CR"</span>,<span class="st">"HV"</span>) <span class="sc">~</span> <span class="st">"AREF-D"</span>, <span class="co"># AREF différée</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"HG"</span> <span class="sc">~</span> <span class="st">"CFF"</span>, <span class="co"># Allocation de complément de fin de formation</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FM"</span>,<span class="st">"HR"</span>) <span class="sc">~</span> <span class="st">"ARER"</span>, <span class="co"># ARE rattrapage</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FP"</span>,<span class="st">"HS"</span>) <span class="sc">~</span> <span class="st">"ARER-F"</span> , <span class="co"># ARER formation</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CT"</span>,<span class="st">"DT"</span>,<span class="st">"EN"</span>) <span class="sc">~</span> <span class="st">"ARER-I"</span>, <span class="co"># ARER intermittent</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CU"</span>,<span class="st">"DU"</span>,<span class="st">"EO"</span>) <span class="sc">~</span> <span class="st">"ARER-FI"</span>, <span class="co"># ARER formation intermittent</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EA"</span>,<span class="st">"GI"</span>) <span class="sc">~</span> <span class="st">"ATI"</span>, <span class="co"># Allocation des travailleurs indépendants </span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EB"</span>,<span class="st">"GJ"</span>) <span class="sc">~</span> <span class="st">"ATIF"</span>, <span class="co"># ATI formation</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EC"</span>,<span class="st">"GS"</span>,<span class="st">"HD"</span>) <span class="sc">~</span> <span class="st">"ADM"</span>, <span class="co"># Allocation des démissionnaires</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EP"</span>,<span class="st">"GT"</span>,<span class="st">"HE"</span>) <span class="sc">~</span> <span class="st">"ADM-F"</span>, <span class="co"># ADM formation</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AM"</span>,<span class="st">"AO"</span>,<span class="st">"AQ"</span>,<span class="st">"BU"</span>,<span class="st">"BV"</span>,<span class="st">"BW"</span>,<span class="st">"BX"</span>,<span class="st">"BY"</span>,<span class="st">"FR"</span>,<span class="st">"FS"</span>,<span class="st">"FT"</span>,<span class="st">"FU"</span>,<span class="st">"FV"</span>,<span class="st">"FW"</span>,<span class="st">"FX"</span>) <span class="sc">~</span> <span class="st">"ASP"</span>, <span class="co"># Allocation de sécurisation professionnelle</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AK"</span>,<span class="st">"GK"</span>) <span class="sc">~</span> <span class="st">"ASP-ARE"</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AN"</span>,<span class="st">"AP"</span>,<span class="st">"AR"</span>,<span class="st">"BZ"</span>,<span class="st">"CA"</span>,<span class="st">"CB"</span>,<span class="st">"CC"</span>,<span class="st">"GC"</span>,<span class="st">"GD"</span>,<span class="st">"GE"</span>,<span class="st">"GF"</span>,<span class="st">"GG"</span>,<span class="st">"GH"</span>) <span class="sc">~</span> <span class="st">"ASP-F"</span>, <span class="co"># ASP formation</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AL"</span>,<span class="st">"GL"</span>) <span class="sc">~</span> <span class="st">"ASP-AREF"</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AG"</span>,<span class="st">"AS"</span>,<span class="st">"CD"</span>,<span class="st">"FY"</span>) <span class="sc">~</span> <span class="st">"IDR-CSP"</span>, <span class="co"># Indemnité différentielle de reclassement - Contrat de sécurisation professionnel</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"61"</span> <span class="sc">~</span> <span class="st">"ASR"</span>, <span class="co"># Allocation spécifique de reclassement</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"62"</span> <span class="sc">~</span> <span class="st">"ASR-ARE"</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"84"</span> <span class="sc">~</span> <span class="st">"ASR-F"</span>, <span class="co"># ASR formation</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"85"</span> <span class="sc">~</span> <span class="st">"ASR-AREF"</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"70"</span>,<span class="st">"88"</span>,<span class="st">"91"</span>) <span class="sc">~</span> <span class="st">"ATP"</span>, <span class="co"># Allocation de transition professionnelle</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"66"</span>,<span class="st">"86"</span>,<span class="st">"AG"</span>) <span class="sc">~</span> <span class="st">"ADR"</span>, <span class="co"># Aide différentielle de reclassement</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"68"</span>,<span class="st">"87"</span>,<span class="st">"AH"</span>,<span class="st">"AZ"</span>,<span class="st">"DR"</span>,<span class="st">"ED"</span>,<span class="st">"EH"</span>,<span class="st">"GX"</span>) <span class="sc">~</span> <span class="st">"ARCE"</span>, <span class="co"># Aide à la reprise ou à la création d'entreprise</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"CP"</span> <span class="sc">~</span> <span class="st">"ARCE-I"</span>, <span class="co"># ARCE intermittent</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AW"</span>,<span class="st">"BL"</span>,<span class="st">"CS"</span>,<span class="st">"CV"</span>,<span class="st">"DN"</span>,<span class="st">"EG"</span>,<span class="st">"GW"</span>) <span class="sc">~</span> <span class="st">"DC"</span>, <span class="co"># Allocation décès</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"57"</span> <span class="sc">~</span> <span class="st">"AFPS"</span>, <span class="co"># Allocation du Fonds de professionnalisation et de solidarité</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"58"</span> <span class="sc">~</span> <span class="st">"AFPS-F"</span>, <span class="co"># AFPS formation</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"59"</span> <span class="sc">~</span> <span class="st">"AFT"</span>, <span class="co"># Allocation du Fonds transitoire</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"60"</span> <span class="sc">~</span> <span class="st">"AFT-F"</span>, <span class="co"># AFT formation</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"23"</span>,<span class="st">"28"</span>,<span class="st">"31"</span>,<span class="st">"32"</span>) <span class="sc">~</span> <span class="st">"AFD-RAC"</span>, <span class="co"># Allocation de fin de droit</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CH"</span>,<span class="st">"CW"</span>,<span class="st">"ES"</span>,<span class="st">"ET"</span>,<span class="st">"EV"</span>,<span class="st">"EU"</span>,<span class="st">"FA"</span>,<span class="st">"FB"</span>,<span class="st">"FC"</span>,<span class="st">"FD"</span>,<span class="st">"FE"</span>,<span class="st">"FF"</span>,<span class="st">"FG"</span>,<span class="st">"FI"</span>,<span class="st">"FJ"</span>,<span class="st">"FK"</span>,<span class="st">"GM"</span>,<span class="st">"GN"</span>,<span class="st">"GP"</span>,<span class="st">"GQ"</span>,<span class="st">"GR"</span>,<span class="st">"HQ"</span>) <span class="sc">~</span> <span class="st">"RAC-PRM"</span>, <span class="co"># Autres aides et primes</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"25"</span>,<span class="st">"30"</span>,<span class="st">"44"</span>,<span class="st">"56"</span>,<span class="st">"BD"</span>) <span class="sc">~</span> <span class="st">"ASS"</span>, <span class="co"># Allocation de solidarité spécifique</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"51"</span> <span class="sc">~</span> <span class="st">"ASS-F"</span>, <span class="co"># ASS formation</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"24"</span> <span class="sc">~</span> <span class="st">"AI"</span>, <span class="co"># Allocation d'insertion</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"73"</span>,<span class="st">"74"</span>,<span class="st">"90"</span>) <span class="sc">~</span> <span class="st">"ATA"</span>, <span class="co"># Allocation temporaire d'attente</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"52"</span>,<span class="st">"53"</span>,<span class="st">"93"</span>,<span class="st">"94"</span>,<span class="st">"97"</span>,<span class="st">"98"</span>) <span class="sc">~</span> <span class="st">"AER"</span>, <span class="co"># Allocation équivalent retraite</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AT"</span>,<span class="st">"AV"</span>,<span class="st">"BE"</span>,<span class="st">"BF"</span>,<span class="st">"BS"</span>,<span class="st">"BT"</span>) <span class="sc">~</span> <span class="st">"ATS"</span>, <span class="co"># Allocation transitoire de solidarité</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"04"</span>,<span class="st">"63"</span>) <span class="sc">~</span> <span class="st">"AF"</span>, <span class="co"># Allocation forfaitaire</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"71"</span>,<span class="st">"75"</span>,<span class="st">"DV"</span>) <span class="sc">~</span> <span class="st">"APS"</span>, <span class="co"># Allocation de professionnalisation et de solidarité</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"72"</span>,<span class="st">"76"</span>,<span class="st">"DX"</span>) <span class="sc">~</span> <span class="st">"APS-F"</span>, <span class="co"># APS formation</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"77"</span>,<span class="st">"DW"</span>) <span class="sc">~</span> <span class="st">"AFD"</span>, <span class="co"># Allocation de fin de droit</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"78"</span>,<span class="st">"DY"</span>) <span class="sc">~</span> <span class="st">"AFD-F"</span>, <span class="co"># AFD formation</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"96"</span>  <span class="sc">~</span> <span class="st">"AEPE"</span>, <span class="co"># Alocation exceptionnelle de retour à l'emploi</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"99"</span>,<span class="st">"AY"</span>,<span class="st">"BG"</span>,<span class="st">"BJ"</span>,<span class="st">"BR"</span>,<span class="st">"CI"</span>,<span class="st">"CX"</span>,<span class="st">"DZ"</span>,<span class="st">"EE"</span>) <span class="sc">~</span> <span class="st">"RFF-RSN"</span>, <span class="co"># Rémunération de fin de formation (régime Etat)</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"39"</span> <span class="sc">~</span> <span class="st">"RSP"</span>, <span class="co"># Rémunération des stagiaires du régime public</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"92"</span>,<span class="st">"95"</span>)<span class="sc">~</span> <span class="st">"AFDEF"</span>, <span class="co"># Allocation en faveur des demandeurs d'emploi en formation</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"29"</span> <span class="sc">~</span> <span class="st">"ASC"</span>, <span class="co"># Allocation spécifique de conversion</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"41"</span>,<span class="st">"50"</span>,<span class="st">"FA"</span>) <span class="sc">~</span> <span class="st">"AFF"</span>, <span class="co"># Allocation de fin de formation</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"45"</span> <span class="sc">~</span> <span class="st">"ACCRE-ASS"</span>, <span class="co"># Aide aux chômeurs créateurs d'entreprise</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AE"</span>,<span class="st">"BH"</span>,<span class="st">"BM"</span>,<span class="st">"CL"</span>,<span class="st">"DO"</span>,<span class="st">"EI"</span>,<span class="st">"EY"</span>,<span class="st">"FN"</span>,<span class="st">"GY"</span>,<span class="st">"HL"</span>) <span class="sc">~</span> <span class="st">"ARE-CG"</span>, <span class="co"># ARE-convention de gestion</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AF"</span>,<span class="st">"BI"</span>,<span class="st">"BO"</span>,<span class="st">"CM"</span>,<span class="st">"DR"</span>,<span class="st">"EM"</span>,<span class="st">"EZ"</span>,<span class="st">"FQ"</span>,<span class="st">"HA"</span>,<span class="st">"HP"</span>) <span class="sc">~</span> <span class="st">"AREF-CG"</span>,</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"81"</span> <span class="sc">~</span> <span class="st">"RFFT"</span>, <span class="co"># Rémunération formation France Travail</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EQ"</span>,<span class="st">"ER"</span>,<span class="st">"FH"</span>,<span class="st">"GU"</span>,<span class="st">"HH"</span>,<span class="st">"HT"</span>) <span class="sc">~</span> <span class="st">"RFF"</span>, <span class="co"># Rémunération de fin de formation</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0C"</span>,<span class="st">"0E"</span>,<span class="st">"15"</span>) <span class="sc">~</span> <span class="st">"ASFNE"</span>, <span class="co"># Allocation conventionnelle du Fonds national de l'emploi (pré-retraite)</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"11"</span>,<span class="st">"17"</span>,<span class="st">"18"</span>) <span class="sc">~</span> <span class="st">"PRP"</span>, <span class="co"># Pré-retraite progressive</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"26"</span> <span class="sc">~</span> <span class="st">"ACO"</span>, <span class="co"># Allocation complémentaire</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"42"</span> <span class="sc">~</span> <span class="st">"ARPE"</span>, <span class="co"># Allocation de remplacement pour l'emploi</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CY"</span>,<span class="st">"CZ"</span>,<span class="st">"DA"</span>,<span class="st">"DB"</span>,<span class="st">"DC"</span>,<span class="st">"DD"</span>,<span class="st">"DE"</span>,<span class="st">"DF"</span>,<span class="st">"DG"</span>,<span class="st">"DH"</span>,<span class="st">"DI"</span>,<span class="st">"DJ"</span>,<span class="st">"DK"</span>,<span class="st">"DL"</span>) <span class="sc">~</span> <span class="st">"AAP"</span>, <span class="co"># Allocation d'accompagnement personnalisé</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">==</span> <span class="st">"AI"</span> <span class="sc">~</span> <span class="st">"ADR-CG"</span>, <span class="co"># Aide différentielle de reclassement convention de gestion</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AJ"</span>,<span class="st">"BA"</span>,<span class="st">"CP"</span>,<span class="st">"DS"</span>,<span class="st">"EK"</span>,<span class="st">"HC"</span>,<span class="st">"HN"</span>) <span class="sc">~</span> <span class="st">"ARCE-CG"</span>,</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>                                KCALF <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DP"</span>,<span class="st">"EJ"</span>,<span class="st">"HB"</span>) <span class="sc">~</span> <span class="st">"DC-CG"</span>,</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>                                T <span class="sc">~</span> <span class="st">"NA"</span>))</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>pjc_fm <span class="ot">&lt;-</span> codes_pjc <span class="sc">%&gt;%</span> </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_midas,KROD3,KDDPJ,KDFPJ,code_alloc,KCPJC) <span class="sc">%&gt;%</span> <span class="co"># On conserve les variables d'intérêt</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(KDDPJ <span class="sc">&lt;=</span> date_fin <span class="sc">&amp;</span> KDFPJ <span class="sc">&gt;=</span> date_fin)  <span class="co"># On se restreint aux indemnisables à fin décembre</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>prm_fm <span class="ot">&lt;-</span> PRM_s <span class="sc">%&gt;%</span> </span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_midas,KROD7,KDDTA,KDFTA,KCDPR) <span class="sc">%&gt;%</span> </span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prime =</span> <span class="fu">case_when</span>(KCDPR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AAAH"</span>,<span class="st">"AAAH16"</span>) <span class="sc">~</span> <span class="st">"CW"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ACEJ"</span> <span class="sc">~</span> <span class="st">"FG"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ADR11"</span> <span class="sc">~</span> <span class="st">"AG"</span>, <span class="co"># IDR-CSP</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AES-S22"</span> <span class="sc">~</span> <span class="st">"GP"</span>, <span class="co"># RAC-PRM (GO correspond à la même aide)</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AGDE"</span> <span class="sc">~</span> <span class="st">"FB"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AFD"</span> <span class="sc">~</span> <span class="st">"77"</span>, <span class="co"># AFD</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AFFORM"</span> <span class="sc">~</span> <span class="st">"FA"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AIJ20"</span> <span class="sc">~</span> <span class="st">"ET"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AIJA20"</span> <span class="sc">~</span> <span class="st">"EV"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AJD20"</span> <span class="sc">~</span> <span class="st">"EU"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"APJE"</span> <span class="sc">~</span> <span class="st">"FK"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE06"</span> <span class="sc">~</span> <span class="st">"68"</span>, <span class="co"># ARCE</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE12"</span> <span class="sc">~</span> <span class="st">"AZ"</span>, <span class="co"># ARCE</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE12CG"</span> <span class="sc">~</span> <span class="st">"BA"</span>, <span class="co"># ARCE-CG</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE17"</span> <span class="sc">~</span> <span class="st">"DR"</span>, <span class="co"># ARCE</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE19"</span> <span class="sc">~</span> <span class="st">"EH"</span>, <span class="co"># ARCE</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE23"</span> <span class="sc">~</span> <span class="st">"GX"</span>, <span class="co"># ARCE</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE24"</span> <span class="sc">~</span> <span class="st">"HK"</span>, <span class="co"># ARCE</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE23CG"</span> <span class="sc">~</span> <span class="st">"HC"</span>, <span class="co"># ARCECG</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCE24CG"</span> <span class="sc">~</span> <span class="st">"HN"</span>, <span class="co"># ARCECG</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCEA816"</span> <span class="sc">~</span> <span class="st">"CP"</span>, <span class="co"># ARCECG</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCECG17"</span> <span class="sc">~</span> <span class="st">"DS"</span>, <span class="co"># ARCECG</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARCECG19"</span> <span class="sc">~</span> <span class="st">"EK"</span>, <span class="co"># ARCECG</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARE"</span> <span class="sc">~</span> <span class="st">"AC"</span>, <span class="co"># ARE</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARE-CG"</span> <span class="sc">~</span> <span class="st">"AE"</span>, <span class="co"># ARE-CG</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ARE03"</span> <span class="sc">~</span> <span class="st">"54"</span>, <span class="co"># ARE</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"AREG"</span> <span class="sc">~</span> <span class="st">"GQ"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ASP15"</span> <span class="sc">~</span> <span class="st">"BU"</span>, <span class="co"># ASP</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ASP21"</span> <span class="sc">~</span> <span class="st">"FR"</span>, <span class="co"># ASP</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ASP21DC"</span> <span class="sc">~</span> <span class="st">"FW"</span>, <span class="co"># ASP</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"ASS04"</span> <span class="sc">~</span> <span class="st">"56"</span>, <span class="co"># ASS</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"CSPPR15"</span> <span class="sc">~</span> <span class="st">"CE"</span>, <span class="co"># ASP</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"CSPPR15R"</span> <span class="sc">~</span> <span class="st">"CG"</span>, <span class="co"># ASP</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"CSPPR21"</span> <span class="sc">~</span> <span class="st">"FZ"</span>, <span class="co"># ASP</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"CSPPR21E"</span> <span class="sc">~</span> <span class="st">"GA"</span>,<span class="co"># ASP</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DC/ARE06"</span>,<span class="st">"DC/ARE09"</span>,<span class="st">"DC/ARE11"</span>,<span class="st">"DC/ARE14"</span>,<span class="st">"DC/ARE17"</span>,<span class="st">"DC/ARE19"</span>,<span class="st">"DC/ARE23"</span>) <span class="sc">~</span> <span class="st">"GW"</span>, <span class="co"># DC</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"DC/ARECG"</span> <span class="sc">~</span> <span class="st">"HB"</span>, <span class="co"># DC-CG</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"DCA816"</span> <span class="sc">~</span> <span class="st">"CS"</span>, <span class="co"># DC</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"DELD"</span> <span class="sc">~</span> <span class="st">"FJ"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"FSSAACRE"</span> <span class="sc">~</span> <span class="st">"FC"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"FSSAAFAM"</span> <span class="sc">~</span> <span class="st">"FE"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"FSSAAMOB"</span> <span class="sc">~</span> <span class="st">"FD"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"FSSAMASP"</span> <span class="sc">~</span> <span class="st">"GM"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"FSSAMRAN"</span> <span class="sc">~</span> <span class="st">"GN"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"FSSAPREC"</span> <span class="sc">~</span> <span class="st">"FF"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"FSSARTRI"</span> <span class="sc">~</span> <span class="st">"GR"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"IDR"</span> <span class="sc">~</span> <span class="st">"AS"</span>, <span class="co"># IDR-CSP</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"IDRCSP15"</span> <span class="sc">~</span> <span class="st">"CD"</span>, <span class="co"># IDR-CSP</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"IDRCSP21"</span> <span class="sc">~</span> <span class="st">"FY"</span>, <span class="co"># IDR</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"INFL21"</span> <span class="sc">~</span> <span class="st">"FI"</span>, <span class="co"># # RAC-PRM</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"JO24"</span> <span class="sc">~</span> <span class="st">"HQ"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"PEP20"</span> <span class="sc">~</span> <span class="st">"ES"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>                           KCDPR <span class="sc">==</span> <span class="st">"PTS15"</span> <span class="sc">~</span> <span class="st">"CH"</span>, <span class="co"># RAC-PRM</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>                           T <span class="sc">~</span> <span class="st">"NA"</span>), </span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>         <span class="at">code_prime =</span> <span class="fu">case_when</span>(prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"54"</span>,<span class="st">"AC"</span>) <span class="sc">~</span> <span class="st">"ARE"</span>,</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BU"</span>,<span class="st">"CE"</span>,<span class="st">"CG"</span>,<span class="st">"FR"</span>,<span class="st">"FW"</span>,<span class="st">"FZ"</span>,<span class="st">"GA"</span>) <span class="sc">~</span> <span class="st">"ASP"</span>,</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AG"</span>,<span class="st">"AS"</span>,<span class="st">"CD"</span>,<span class="st">"FY"</span>) <span class="sc">~</span> <span class="st">"IDR-CSP"</span>,</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">==</span> <span class="st">"77"</span> <span class="sc">~</span> <span class="st">"AFD"</span>,</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"68"</span>,<span class="st">"AH"</span>,<span class="st">"AZ"</span>,<span class="st">"DR"</span>,<span class="st">"ED"</span>,<span class="st">"EH"</span>,<span class="st">"GX"</span>,<span class="st">"HK"</span>) <span class="sc">~</span> <span class="st">"ARCE"</span>,</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AW"</span>,<span class="st">"BL"</span>,<span class="st">"CS"</span>,<span class="st">"CV"</span>,<span class="st">"DN"</span>,<span class="st">"EG"</span>,<span class="st">"GW"</span>) <span class="sc">~</span> <span class="st">"DC"</span>,</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CH"</span>,<span class="st">"CW"</span>,<span class="st">"ES"</span>,<span class="st">"ET"</span>,<span class="st">"EV"</span>,<span class="st">"EU"</span>,<span class="st">"FA"</span>,<span class="st">"FB"</span>,<span class="st">"FC"</span>,<span class="st">"FD"</span>,<span class="st">"FE"</span>,<span class="st">"FF"</span>,<span class="st">"FG"</span>,<span class="st">"FI"</span>,<span class="st">"FJ"</span>,<span class="st">"FK"</span>,<span class="st">"GM"</span>,<span class="st">"GN"</span>,<span class="st">"GP"</span>,<span class="st">"GQ"</span>,<span class="st">"GR"</span>,<span class="st">"HQ"</span>) <span class="sc">~</span> <span class="st">"RAC-PRM"</span>, <span class="co"># Autres aides et primes</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">==</span> <span class="st">"56"</span> <span class="sc">~</span> <span class="st">"ASS"</span>,</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">==</span> <span class="st">"AE"</span> <span class="sc">~</span> <span class="st">"ARE-CG"</span>,</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AJ"</span>,<span class="st">"BA"</span>,<span class="st">"CP"</span>,<span class="st">"DS"</span>,<span class="st">"EK"</span>,<span class="st">"HC"</span>,<span class="st">"HN"</span>) <span class="sc">~</span> <span class="st">"ARCE-CG"</span>,</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>                                prime <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DP"</span>,<span class="st">"EJ"</span>,<span class="st">"HB"</span>) <span class="sc">~</span> <span class="st">"DC-CG"</span>,</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>                                T <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(KDDTA <span class="sc">&lt;=</span> date_fin <span class="sc">&amp;</span> KDFTA <span class="sc">&gt;=</span> date_fin) <span class="co"># On conserve les aides et primes versées sur la période étudiée</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Sélection des variables d'intérêt dans la table ODD</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>odd_fm <span class="ot">&lt;-</span> ODD_s <span class="sc">%&gt;%</span> </span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_midas,KROD1,KCRD)   </span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>alloc_fm <span class="ot">&lt;-</span> pjc_fm <span class="sc">%&gt;%</span> </span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(odd_fm, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id_midas"</span>,<span class="st">"KROD1"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(prm_fm, <span class="at">by =</span> <span class="st">"id_midas"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alloc =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(code_alloc),code_alloc,code_prime),</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>         <span class="at">regime =</span> <span class="fu">case_when</span>(alloc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ARE"</span>,<span class="st">"ARE-I"</span>,<span class="st">"ARED"</span>,<span class="st">"CFD"</span>,<span class="st">"AREF"</span>,<span class="st">"AREF-I"</span>,<span class="st">"AREF-D"</span>,<span class="st">"CFF"</span>,<span class="st">"ARER"</span>,<span class="st">"ARER-F"</span>,<span class="st">"ARER-I"</span>,<span class="st">"ARER-FI"</span>,</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"ATI"</span>,<span class="st">"ATIF"</span>,<span class="st">"ADM"</span>,<span class="st">"ADM-F"</span>,<span class="st">"ASP"</span>,<span class="st">"ASP-ARE"</span>,<span class="st">"ASP-F"</span>,<span class="st">"ASP-AREF"</span>,<span class="st">"IDR-CSP"</span>,<span class="st">"ASR"</span>,<span class="st">"ASR-ARE"</span>,<span class="st">"ASR-F"</span>,<span class="st">"ASR-AREF"</span>,</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"ATP"</span>,<span class="st">"ADR"</span>,<span class="st">"ARCE"</span>,<span class="st">"ARCE-I"</span>,<span class="st">"DC"</span>,<span class="st">"AFPS"</span>,<span class="st">"AFPS-F"</span>,<span class="st">"AFT"</span>,<span class="st">"AFT-F"</span>,<span class="st">"AFD-RAC"</span>,<span class="st">"RAC-PRM"</span>) <span class="sc">~</span> <span class="st">"1"</span>, <span class="co"># Régime de l'assurance-chômage (Unédic)</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>                            alloc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ASS"</span>,<span class="st">"ASS-F"</span>,<span class="st">"AI"</span>,<span class="st">"ATA"</span>,<span class="st">"AER"</span>,<span class="st">"ATS"</span>,<span class="st">"AF"</span>,<span class="st">"APS"</span>,<span class="st">"APS-F"</span>,<span class="st">"AFD"</span>,<span class="st">"AFD-F"</span>,<span class="st">"AEPE"</span>,<span class="st">"RFF-RSN"</span>,<span class="st">"RSP"</span>,<span class="st">"AFDEF"</span>,</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"ASC"</span>,<span class="st">"AFF"</span>,<span class="st">"ACCRE-ASS"</span>) <span class="sc">~</span> <span class="st">"2"</span>, <span class="co"># Régime de solidarité national (Etat)</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>                            alloc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ARE-CG"</span>,<span class="st">"AREF-CG"</span>,<span class="st">"RFFT"</span>,<span class="st">"RFF"</span>,<span class="st">"ASFNE"</span>,<span class="st">"PRP"</span>,<span class="st">"ACO"</span>,<span class="st">"ARPE"</span>,<span class="st">"AAP"</span>,<span class="st">"ADR-CG"</span>,<span class="st">"ARCE-CG"</span>,<span class="st">"DC-CG"</span>) <span class="sc">~</span> <span class="st">"3"</span>, <span class="co"># Régime de France Travail</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>                            T <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sdf_register</span>(<span class="at">name =</span> <span class="st">"alloc_fm_cache"</span>)</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_cache</span>(sc, <span class="at">name =</span> <span class="st">"alloc_fm_cache"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-python.reticulate="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement des tables</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>PJC_s <span class="op">=</span> spark.read.parquet(<span class="st">"hdfs:///dataset/MiDAS_v6/FNA/pjc.parquet"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>PRM_s <span class="op">=</span> spark.read.parquet(<span class="st">"hdfs:///dataset/MiDAS_v6/FNA/prm.parquet"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>ODD_s <span class="op">=</span> spark.read.parquet(<span class="st">"hdfs:///dataset/MiDAS_v6/FNA/odd.parquet"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Période étudiée</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>date_fin <span class="op">=</span> <span class="st">"2024-12-31"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>codes_pjc <span class="op">=</span> (</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    PJC_s</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    .withColumnRenamed(<span class="st">"KROD3"</span>, <span class="st">"KROD1"</span>)  <span class="co"># Renommage pour appariement avec ODD</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>((F.col(<span class="st">"KDDPJ"</span>) <span class="op">&lt;=</span> date_fin) <span class="op">&amp;</span> (F.col(<span class="st">"KDFPJ"</span>) <span class="op">&gt;=</span> date_fin))  <span class="co"># Filtrage des périodes actives à fin décembre</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    .withColumn(<span class="st">"alloc"</span>, F.when(F.col(<span class="st">"KCALF"</span>).isin(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"01"</span>,<span class="st">"21"</span>,<span class="st">"22"</span>,<span class="st">"27"</span>,<span class="st">"40"</span>,<span class="st">"43"</span>,<span class="st">"47"</span>,<span class="st">"54"</span>,<span class="st">"64"</span>,<span class="st">"67"</span>,<span class="st">"82"</span>,<span class="st">"AC"</span>,<span class="st">"BB"</span>,<span class="st">"BK"</span>,<span class="st">"CJ"</span>,<span class="st">"DM"</span>,<span class="st">"EF"</span>,<span class="st">"EW"</span>,<span class="st">"FL"</span>,<span class="st">"GV"</span>,<span class="st">"HF"</span>), <span class="st">"01"</span>)  <span class="co"># ARE</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"CN"</span>, <span class="st">"02"</span>)  <span class="co"># ARE-I</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"BP"</span>,<span class="st">"CQ"</span>,<span class="st">"HD"</span>), <span class="st">"03"</span>)  <span class="co"># ARED</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"33"</span>,<span class="st">"34"</span>,<span class="st">"35"</span>,<span class="st">"48"</span>,<span class="st">"49"</span>,<span class="st">"55"</span>,<span class="st">"65"</span>,<span class="st">"83"</span>,<span class="st">"AD"</span>,<span class="st">"BC"</span>,<span class="st">"BN"</span>,<span class="st">"CK"</span>,<span class="st">"DQ"</span>,<span class="st">"EL"</span>,<span class="st">"EX"</span>,<span class="st">"FO"</span>,<span class="st">"GZ"</span>,<span class="st">"HG"</span>), <span class="st">"04"</span>)  <span class="co"># AREF-I</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"CO"</span>, <span class="st">"05"</span>)  <span class="co"># AREF-I</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"BQ"</span>,<span class="st">"CR"</span>,<span class="st">"HE"</span>), <span class="st">"06"</span>)  <span class="co"># AREF-D</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"FM"</span>, <span class="st">"07"</span>)  <span class="co"># ARER</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"CT"</span>,<span class="st">"DT"</span>,<span class="st">"EN"</span>), <span class="st">"08"</span>)  <span class="co"># ARER-I</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"CU"</span>,<span class="st">"DU"</span>,<span class="st">"EO"</span>), <span class="st">"09"</span>)  <span class="co"># ARER-FI</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"FP"</span>, <span class="st">"10"</span>)  <span class="co"># AREFR</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"EA"</span>,<span class="st">"GI"</span>), <span class="st">"11"</span>)  <span class="co"># ATI</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"EB"</span>,<span class="st">"GJ"</span>), <span class="st">"12"</span>)  <span class="co"># ATIF</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"EC"</span>,<span class="st">"GS"</span>), <span class="st">"13"</span>)  <span class="co"># ADM</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"EP"</span>,<span class="st">"GT"</span>), <span class="st">"14"</span>)  <span class="co"># ADM-F</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"AM"</span>,<span class="st">"AO"</span>,<span class="st">"AQ"</span>,<span class="st">"BU"</span>,<span class="st">"BV"</span>,<span class="st">"BW"</span>,<span class="st">"BX"</span>,<span class="st">"BY"</span>,<span class="st">"FR"</span>,<span class="st">"FS"</span>,<span class="st">"FT"</span>,<span class="st">"FU"</span>,<span class="st">"FV"</span>,<span class="st">"FW"</span>,<span class="st">"FX"</span>), <span class="st">"15"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"AN"</span>,<span class="st">"AP"</span>,<span class="st">"AR"</span>,<span class="st">"BZ"</span>,<span class="st">"CA"</span>,<span class="st">"CB"</span>,<span class="st">"CC"</span>,<span class="st">"GC"</span>,<span class="st">"GD"</span>,<span class="st">"GE"</span>,<span class="st">"GF"</span>,<span class="st">"GG"</span>,<span class="st">"GH"</span>), <span class="st">"16"</span>)  <span class="co"># ASP-F</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"AK"</span>,<span class="st">"GK"</span>), <span class="st">"17"</span>)  <span class="co"># ASP-ARE</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"AL"</span>,<span class="st">"GL"</span>), <span class="st">"18"</span>)  <span class="co"># ASP-AREF</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"61"</span>, <span class="st">"20"</span>)  <span class="co"># ASR</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"84"</span>, <span class="st">"21"</span>)  <span class="co"># ASRF</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"62"</span>, <span class="st">"22"</span>)  <span class="co"># ASR-ARE</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"85"</span>, <span class="st">"23"</span>)  <span class="co"># ASR-AREF</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"70"</span>,<span class="st">"88"</span>,<span class="st">"91"</span>), <span class="st">"24"</span>)  <span class="co"># ATP</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"66"</span>,<span class="st">"86"</span>,<span class="st">"AG"</span>), <span class="st">"25"</span>)  <span class="co"># ADR</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"CP"</span>, <span class="st">"27"</span>)  <span class="co"># ARCE-I</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"57"</span>, <span class="st">"29"</span>)  <span class="co"># AFPS</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"58"</span>, <span class="st">"30"</span>)  <span class="co"># AFPSF</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"59"</span>, <span class="st">"31"</span>)  <span class="co"># AFT</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"60"</span>, <span class="st">"32"</span>)  <span class="co"># AFTF</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"23"</span>,<span class="st">"28"</span>,<span class="st">"31"</span>,<span class="st">"32"</span>), <span class="st">"33"</span>)  <span class="co"># AFD-RAC</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"25"</span>,<span class="st">"30"</span>,<span class="st">"44"</span>,<span class="st">"56"</span>,<span class="st">"BD"</span>), <span class="st">"34"</span>)  <span class="co"># ASS</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"51"</span>, <span class="st">"35"</span>)  <span class="co"># ASS-F</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"24"</span>, <span class="st">"36"</span>)  <span class="co"># AI</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"73"</span>,<span class="st">"74"</span>,<span class="st">"90"</span>), <span class="st">"37"</span>)  <span class="co"># ATA</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"52"</span>,<span class="st">"53"</span>,<span class="st">"93"</span>,<span class="st">"94"</span>,<span class="st">"97"</span>,<span class="st">"98"</span>), <span class="st">"38"</span>)  <span class="co"># AER</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"AT"</span>,<span class="st">"AV"</span>,<span class="st">"BE"</span>,<span class="st">"BF"</span>,<span class="st">"BS"</span>,<span class="st">"BT"</span>), <span class="st">"39"</span>)  <span class="co"># ATS</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"04"</span>,<span class="st">"63"</span>), <span class="st">"40"</span>)  <span class="co"># AF</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"71"</span>,<span class="st">"75"</span>,<span class="st">"DV"</span>), <span class="st">"41"</span>)  <span class="co"># APS</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"72"</span>,<span class="st">"76"</span>,<span class="st">"DX"</span>), <span class="st">"42"</span>)  <span class="co"># APS-F</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"77"</span>,<span class="st">"DW"</span>), <span class="st">"43"</span>)  <span class="co"># AFD</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"78"</span>,<span class="st">"DY"</span>), <span class="st">"44"</span>)  <span class="co"># AFD-F</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"96"</span>, <span class="st">"45"</span>)  <span class="co"># AEPE</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"99"</span>,<span class="st">"AY"</span>,<span class="st">"BG"</span>,<span class="st">"BJ"</span>,<span class="st">"BR"</span>,<span class="st">"CI"</span>,<span class="st">"CX"</span>,<span class="st">"DZ"</span>,<span class="st">"EE"</span>), <span class="st">"46"</span>)  <span class="co"># RFF</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"39"</span>, <span class="st">"47"</span>)  <span class="co"># RSP</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"92"</span>,<span class="st">"95"</span>), <span class="st">"48"</span>)  <span class="co"># AFDEF</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"29"</span>, <span class="st">"49"</span>)  <span class="co"># ASC</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"41"</span>,<span class="st">"50"</span>), <span class="st">"50"</span>)  <span class="co"># AFF</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"45"</span>, <span class="st">"51"</span>)  <span class="co"># ACCRE-ASS</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"AE"</span>,<span class="st">"BH"</span>,<span class="st">"BM"</span>,<span class="st">"CL"</span>,<span class="st">"DO"</span>,<span class="st">"EI"</span>,<span class="st">"EY"</span>,<span class="st">"FN"</span>,<span class="st">"GY"</span>), <span class="st">"52"</span>)  <span class="co"># ARE-CG</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"AF"</span>,<span class="st">"BI"</span>,<span class="st">"BO"</span>,<span class="st">"CM"</span>,<span class="st">"DR"</span>,<span class="st">"EM"</span>,<span class="st">"EZ"</span>,<span class="st">"FQ"</span>,<span class="st">"HA"</span>), <span class="st">"53"</span>)  <span class="co"># AREF-CG</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"81"</span>, <span class="st">"54"</span>)  <span class="co"># RFPE</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"EQ"</span>,<span class="st">"ER"</span>,<span class="st">"FH"</span>,<span class="st">"GU"</span>,<span class="st">"HH"</span>), <span class="st">"55"</span>)  <span class="co"># RFF</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"0C"</span>,<span class="st">"0E"</span>,<span class="st">"15"</span>), <span class="st">"56"</span>)  <span class="co"># ASFNE</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"11"</span>,<span class="st">"17"</span>,<span class="st">"18"</span>), <span class="st">"57"</span>)  <span class="co"># PRP</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"26"</span>, <span class="st">"58"</span>)  <span class="co"># ACO</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"42"</span>, <span class="st">"59"</span>)  <span class="co"># ARPE</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>).isin(<span class="st">"CY"</span>,<span class="st">"CZ"</span>,<span class="st">"DA"</span>,<span class="st">"DB"</span>,<span class="st">"DC"</span>,<span class="st">"DD"</span>,<span class="st">"DE"</span>,<span class="st">"DF"</span>,<span class="st">"DG"</span>,<span class="st">"DH"</span>,<span class="st">"DI"</span>,<span class="st">"DJ"</span>,<span class="st">"DK"</span>,<span class="st">"DL"</span>), <span class="st">"60"</span>)  <span class="co"># AAP</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCALF"</span>) <span class="op">==</span> <span class="st">"AI"</span>, <span class="st">"61"</span>)  <span class="co"># ADR-CG</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="st">"NA"</span>)  <span class="co"># Valeur par défaut</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    .withColumn(<span class="st">"regime_alloc"</span>, F.when(F.col(<span class="st">"alloc"</span>).isin(</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"01"</span>,<span class="st">"02"</span>,<span class="st">"03"</span>,<span class="st">"04"</span>,<span class="st">"05"</span>,<span class="st">"06"</span>,<span class="st">"07"</span>,<span class="st">"08"</span>,<span class="st">"09"</span>,<span class="st">"10"</span>,<span class="st">"11"</span>,<span class="st">"12"</span>,<span class="st">"13"</span>,<span class="st">"14"</span>,<span class="st">"15"</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">"16"</span>,<span class="st">"17"</span>,<span class="st">"18"</span>,<span class="st">"20"</span>,<span class="st">"21"</span>,<span class="st">"22"</span>,<span class="st">"23"</span>,<span class="st">"24"</span>,<span class="st">"25"</span>,<span class="st">"27"</span>,<span class="st">"29"</span>,<span class="st">"30"</span>,<span class="st">"31"</span>,<span class="st">"32"</span>,<span class="st">"33"</span>,<span class="st">"RAC-PRM"</span>), <span class="st">"1"</span>)  <span class="co"># Régime de l'assurance-chômage</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"alloc"</span>).isin(</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"34"</span>,<span class="st">"35"</span>,<span class="st">"36"</span>,<span class="st">"37"</span>,<span class="st">"38"</span>,<span class="st">"39"</span>,<span class="st">"40"</span>,<span class="st">"41"</span>,<span class="st">"42"</span>,<span class="st">"43"</span>,<span class="st">"44"</span>,<span class="st">"45"</span>,<span class="st">"46"</span>,<span class="st">"47"</span>,<span class="st">"48"</span>,<span class="st">"49"</span>,<span class="st">"50"</span>,<span class="st">"51"</span>), <span class="st">"2"</span>)  <span class="co"># Régime de l'État</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"alloc"</span>).isin(</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"52"</span>,<span class="st">"53"</span>,<span class="st">"54"</span>,<span class="st">"55"</span>,<span class="st">"56"</span>,<span class="st">"57"</span>,<span class="st">"58"</span>,<span class="st">"59"</span>,<span class="st">"60"</span>,<span class="st">"61"</span>), <span class="st">"3"</span>)  <span class="co"># Régime de France Travail</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="st">"NA"</span>)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>prm_fm <span class="op">=</span> (</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    PRM_s</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"id_midas"</span>, <span class="st">"KROD7"</span>, <span class="st">"KDDTA"</span>, <span class="st">"KDFTA"</span>, <span class="st">"KCDPR"</span>)</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    .withColumn(<span class="st">"prime"</span>, F.when(F.col(<span class="st">"KCDPR"</span>).isin(<span class="st">"AAAH"</span>, <span class="st">"AAAH16"</span>), <span class="st">"CW"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ACEJ"</span>, <span class="st">"FG"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ADR11"</span>, <span class="st">"AG"</span>)  <span class="co"># IDR-CSP</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"AES-S22"</span>, <span class="st">"GP"</span>)  <span class="co"># RAC-PRM (GO correspond à la même aide)</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"AFFORM"</span>, <span class="st">"FA"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"AIJ20"</span>, <span class="st">"ET"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"AIJA20"</span>, <span class="st">"EV"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"AJD20"</span>, <span class="st">"EU"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"APJE"</span>, <span class="st">"FK"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCE06"</span>, <span class="st">"68"</span>)  <span class="co"># ARCE</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCE12"</span>, <span class="st">"AZ"</span>)  <span class="co"># ARCE</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCE12CG"</span>, <span class="st">"BA"</span>)  <span class="co"># ARCE-CG</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCE17"</span>, <span class="st">"DR"</span>)  <span class="co"># ARCE</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCE19"</span>, <span class="st">"EH"</span>)  <span class="co"># ARCE</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCE23"</span>, <span class="st">"GX"</span>)  <span class="co"># ARCE</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCE23CG"</span>, <span class="st">"HC"</span>)  <span class="co"># ARCECG</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCEA816"</span>, <span class="st">"CP"</span>)  <span class="co"># ARCECG</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCECG17"</span>, <span class="st">"DS"</span>)  <span class="co"># ARCECG</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARCECG19"</span>, <span class="st">"EK"</span>)  <span class="co"># ARCECG</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARE"</span>, <span class="st">"AC"</span>)  <span class="co"># ARE</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARE-CG"</span>, <span class="st">"AE"</span>)  <span class="co"># ARE-CG</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ARE03"</span>, <span class="st">"54"</span>)  <span class="co"># ARE</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"AREG"</span>, <span class="st">"GQ"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ASP15"</span>, <span class="st">"BU"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ASP21"</span>, <span class="st">"FR"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ASP21DC"</span>, <span class="st">"FW"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"ASS04"</span>, <span class="st">"56"</span>)  <span class="co"># ASS</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"CSPPR15"</span>, <span class="st">"CE"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"CSPPR15R"</span>, <span class="st">"CG"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"CSPPR21"</span>, <span class="st">"FZ"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"CSPPR21E"</span>, <span class="st">"GA"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>).isin(<span class="st">"DCARE06"</span>,<span class="st">"DCARE09"</span>,<span class="st">"DCARE11"</span>,<span class="st">"DCARE14"</span>,<span class="st">"DCARE17"</span>,<span class="st">"DCARE19"</span>,<span class="st">"DCARE23"</span>), <span class="st">"GW"</span>)  <span class="co"># DC</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"DCARECG"</span>, <span class="st">"HB"</span>)  <span class="co"># DC-CG</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"DCA816"</span>, <span class="st">"CS"</span>)  <span class="co"># DC</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"DELD"</span>, <span class="st">"FJ"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"FSSAACRE"</span>, <span class="st">"FC"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"FSSAAFAM"</span>, <span class="st">"FE"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"FSSAAMOB"</span>, <span class="st">"FD"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"FSSAMASP"</span>, <span class="st">"GM"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"FSSAMRAN"</span>, <span class="st">"GN"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"FSSAPREC"</span>, <span class="st">"FF"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"FSSARTRI"</span>, <span class="st">"GR"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"IDR"</span>, <span class="st">"AS"</span>)  <span class="co"># IDR-CSP</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"IDRCSP15"</span>, <span class="st">"CD"</span>)  <span class="co"># IDR-CSP</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"IDRCSP21"</span>, <span class="st">"FY"</span>)  <span class="co"># IDR</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"INFL21"</span>, <span class="st">"FI"</span>)  <span class="co"># à définir</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"JO2024"</span>, <span class="st">""</span>)  <span class="co"># à définir</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"PEP20"</span>, <span class="st">"ES"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"KCDPR"</span>) <span class="op">==</span> <span class="st">"PTS15"</span>, <span class="st">"CH"</span>)  <span class="co"># RAC-PRM</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="st">"NA"</span>)</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    .withColumn(<span class="st">"prime_alloc"</span>, F.when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"54"</span>, <span class="st">"AC"</span>), <span class="st">"01"</span>)  <span class="co"># ARE</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"BU"</span>,<span class="st">"CE"</span>,<span class="st">"CG"</span>,<span class="st">"FR"</span>,<span class="st">"FW"</span>,<span class="st">"FZ"</span>,<span class="st">"GA"</span>), <span class="st">"15"</span>)  <span class="co"># ASP</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"AG"</span>,<span class="st">"AS"</span>,<span class="st">"CD"</span>,<span class="st">"FY"</span>), <span class="st">"19"</span>)  <span class="co"># IDR-CSP</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"68"</span>,<span class="st">"87"</span>,<span class="st">"AH"</span>,<span class="st">"AZ"</span>,<span class="st">"DR"</span>,<span class="st">"ED"</span>,<span class="st">"EH"</span>,<span class="st">"GX"</span>), <span class="st">"26"</span>)  <span class="co"># ARCE</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"AW"</span>,<span class="st">"BL"</span>,<span class="st">"CS"</span>,<span class="st">"CV"</span>,<span class="st">"DN"</span>,<span class="st">"EG"</span>,<span class="st">"GW"</span>), <span class="st">"28"</span>)  <span class="co"># DC</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"CH"</span>,<span class="st">"CW"</span>,<span class="st">"ES"</span>,<span class="st">"ET"</span>,<span class="st">"EV"</span>,<span class="st">"EU"</span>,<span class="st">"FA"</span>,<span class="st">"FC"</span>,<span class="st">"FD"</span>,<span class="st">"FE"</span>,<span class="st">"FF"</span>,<span class="st">"FG"</span>,<span class="st">"FJ"</span>,<span class="st">"FK"</span>,<span class="st">"GM"</span>,<span class="st">"GN"</span>,<span class="st">"GP"</span>,<span class="st">"GQ"</span>,<span class="st">"GR"</span>), <span class="st">"RAC-PRM"</span>)  <span class="co"># Autres aides</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>) <span class="op">==</span> <span class="st">"56"</span>, <span class="st">"34"</span>)  <span class="co"># ASS</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>) <span class="op">==</span> <span class="st">"AE"</span>, <span class="st">"52"</span>)  <span class="co"># ARE-CG</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"AJ"</span>,<span class="st">"BA"</span>,<span class="st">"CP"</span>,<span class="st">"DS"</span>,<span class="st">"EK"</span>,<span class="st">"HC"</span>), <span class="st">"62"</span>)  <span class="co"># ARCE-CG</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>        .when(F.col(<span class="st">"prime"</span>).isin(<span class="st">"DP"</span>,<span class="st">"EJ"</span>,<span class="st">"HB"</span>), <span class="st">"63"</span>)  <span class="co"># DC-CG</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="st">"NA"</span>)</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>((F.col(<span class="st">"KDDTA"</span>) <span class="op">&lt;=</span> date_fin) <span class="op">&amp;</span> (F.col(<span class="st">"KDFTA"</span>) <span class="op">&gt;=</span> date_fin))  <span class="co"># Filtrage des aides versées sur la période étudiée</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>alloc_fm <span class="op">=</span> (</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    pjc_fm</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    .join(ODD_s, on<span class="op">=</span>[<span class="st">"id_midas"</span>, <span class="st">"KROD1"</span>], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    .join(prm_fm, on<span class="op">=</span><span class="st">"id_midas"</span>, how<span class="op">=</span><span class="st">"left"</span>) </span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>alloc_fm.registerTempTable(<span class="st">"alloc_fm_cache"</span>)</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>spark.catalog.cacheTable(<span class="st">"alloc_fm_cache"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/DocumentationMiDAS\.github\.io\/Documentation_MiDAS\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>